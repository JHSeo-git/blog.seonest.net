---
date: '2022-11-29T04:20:50.018Z'
category: javascript
title: '동적으로 OG Image 만들기, edge-function을 포함한'
description: 최근 Vercel에서 satori라는 dynamic og-image generator를 공개했습니다. 어떤 점이 기존과 차이가 있고 어떻게 만들었는지 확인해보았습니다.
draft: false
tags: ['JavaScript', 'Vercel', 'OpenGraph']
# thumbnail: '/post/javascript/동적으로-og-image-만들기-edge-function을-포함한/thumbnail.png'
---

Vercel은 4년 전에 Serverless 환경에서 Open Graph Image를 동적으로 생성할 수 있는 [dynamic og-image generator](https://github.com/vercel/og-image)를 공개했습니다.
그리고 얼마전 10월에 HTML and CSS to SVG(or PNG 등) convert할 수 있는 tool인 [satori](https://github.com/vercel/satori)와 함께 새로운 dynamic og-image generator인 [@vercel/og](https://www.npmjs.com/package/@vercel/og)를 공개했습니다.

Vercel은 왜 기존 og-image generator를 새로운 툴과 함께 공개했을까요?  
(제 개인적인 생각은 Vercel의 Edge Functions(Edge runtime)의 기능을 프로모션하는 하나의 제품으로 보여주기 위함도 있지 않을까 생각했습니다.)

## 들어가면서

트위터 트윗 중 카드가 삽입된 트윗 비율이 [40% 더 높습니다.](https://www.agorapulse.com/social-media-lab/link-tweet-with-an-image-vs-tweet-with-twitter-cards-does-it-really-matter/)
정적 소셜 이미지를 만들고 공유하는 것이 어렵지는 않습니다. 그러나 즉시 계산되고 실시간으로 생성해야 하는 **동적 이미지**를 처리하는 것에는 한계가 있었습니다.

## 기존 Open Graph Image Generator

Vercel은 4년전에 Serverless Function 내에 HTML Page를 만들어 스크릿샷을 찍음으로써 동적으로 [open graph](https://ogp.me/) 이미지를 생성하여 개발자들이 사용할 수 있도록 [og-image.vercel.app](https://og-image.vercel.app/)을 발표했습니다.
이 og-image generator는 [puppeteer](https://www.npmjs.com/package/puppeteer-core)를 사용하여 HTML/CSS를 동적으로 Image를 생성했습니다.
이후 수많은 개발자들은 자신들의 소셜 이미지들을 만들기 위해 사용해왔습니다.
그러나 기능적으로 잘 동작했지만 이 접근법은 몇 가지 단점들이 존재했습니다:

- **어렵다**: 이 솔루션은 Serverless Function 내에 크로미움을 실행해야만 합니다. Puppeteer를 통해 HTML을 생성하고 스크린샷을 찍어야 합니다.
  이러한 도구를 설정하는 것이 어려웠고 에러가 나는 경우가 많았습니다.
- **느리다**: 크로미움은 Serverless Function 내에 맞추기 위해 압축하기 때문에 cold boot 시에 압축을 해제해야 합니다.
  이는 매우 느립니다(대략 4초 정도 걸립니다). 그 결과 _소셜 카드 이미지가 느려지거나 깨질 수_ 있습니다.
- **비싸다**: 스크린샷을 찍기 위해 전체 브라우저를 생성하는 것은 비효율적입니다.
  이로 인해 함수가 커져서 비용이 많이 들고 계산 낭비가 될 수 있습니다.
- **크다**: 크로미움은 지난 4년 동안 계속 성장해왔습니다. 현재는 [Serverless Function에 사용하기에는 너무 큽니다.](https://github.com/vercel/og-image/issues/148)

![og-image-generator-deps](/post/javascript/동적으로-og-image-만들기-edge-function을-포함한/og-image-generator-deps.png)

## 새로운 Open Graph Image Generator

최근 공개된 **@vercel/og**는 Edge Functions, WebAssemboly, satori(HTML/CSS to SVGs converter)를 사용하여 기존 og-image generator보다 5배 더 빨라졌습니다.

## reference

- https://vercel.com/docs/concepts/functions/edge-functions/og-image-generation
- https://github.com/vercel/og-image
- https://github.com/vercel/satori
- https://www.npmjs.com/package/@vercel/og
